<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Project Zomboid B42 stats</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    
        <!-- íŒŒë¹„ì½˜ ì¶”ê°€ -->
        <link rel="icon" type="image/png" href="icons/Trait_fastlearner.png">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen lg:w-full sm:w-[600px]">
  <div class="w-full lg:max-w-5xl lg:mx-auto bg-white rounded-xl shadow p-2 sm:p-4">
    
    <!-- ìƒë‹¨ -->
    <div class="sticky top-0 bg-white z-10 p-2 sm:p-4 rounded-2xl shadow-md">
      <h2 class="text-xl sm:text-2xl font-bold mb-2 text-center">
        B42 project Zomboid ì§ì—… ë° íŠ¹ì„± ê³„ì‚°ê¸° <span id="version-text"></span>
      </h2>

      <div class="flex space-x-2 mb-4 justify-center">
        <button id="openModalBtn" class="px-3 py-2 sm:px-4 sm:py-2 bg-blue-500 text-white rounded-lg shadow text-sm sm:text-base">
          ê³µì§€ì‚¬í•­
        </button>
        <button id="lang-ko" class="px-3 py-2 bg-gray-200 rounded text-sm sm:text-base">í•œêµ­ì–´</button>
        <button id="lang-en" class="px-3 py-2 bg-gray-200 rounded text-sm sm:text-base">English</button>
      </div>
    </div>

    <!-- ì»¨í…ì¸  -->
    <div class="grid grid-cols-2 grid-rows-2 gap-2 lg:flex lg:space-x-4 max-h-[75vh]">
      
      <!-- ê²°ê³¼ -->
      <div id="result-panel" class="border rounded-xl p-2 overflow-y-auto lg:w-40 min-w-[180px]">
        <h3 class="text-base sm:text-lg font-bold text-center lg:hidden">ê²°ê³¼</h3>
        <div id="result-sum" class="p-2 sm:p-3 border rounded-xl bg-white shadow text-lg sm:text-xl font-bold text-center text-green-600">
          í•©ê³„: 0
        </div>
        <div id="result-strength" class="px-2 py-1 border rounded-xl bg-white shadow text-base sm:text-lg font-semibold text-center text-black-600">
          ê·¼ë ¥: 0
        </div>
        <div id="result-fitness" class="px-2 py-1 border rounded-xl bg-white shadow text-base sm:text-lg font-semibold text-center text-black-600">
          ì²´ë ¥: 0
        </div>
      </div>

      <!-- ì§ì—… -->
      <div id="jobs" class="border rounded-xl p-2 overflow-y-auto lg:flex-1 min-w-[180px]">
        <h3 class="text-base sm:text-lg font-bold text-center lg:hidden">ì§ì—…</h3>
      </div>

      <!-- ê¸ì • -->
      <div id="positive-items" class="border rounded-xl p-2 overflow-y-auto lg:flex-1 min-w-[150px]">
        <h3 class="text-base sm:text-lg font-bold text-center lg:hidden">ê¸ì •</h3>
      </div>

      <!-- ë¶€ì • -->
      <div id="negative-items" class="border rounded-xl p-2 overflow-y-auto lg:flex-1 min-w-[150px] ">
        <h3 class="text-base sm:text-lg font-bold text-center lg:hidden">ë¶€ì •</h3>
      </div>

    </div>
  </div>




<!-- ëª¨ë‹¬ (ì²˜ìŒì—” hidden) -->
<div id="modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
  <div class="bg-white rounded-2xl shadow-xl w-192 p-6 relative">
    <!-- ë‹«ê¸° ë²„íŠ¼ -->
    <button id="closeModalBtn" class="absolute top-2 right-2 text-gray-600 hover:text-black">
      âœ•
    </button>
    
    <h2 class="text-xl font-bold mb-4">ê³µì§€ì‚¬í•­ </h2>
    <p class="mb-2">ğŸ“¢ <span id="version-text2"></span> ì—…ë°ì´íŠ¸ ì•ˆë‚´</p>
    
    <p class="mb-2">- ëª¨ë°”ì¼ ëŒ€ì¶© ì§€ì›(2x2ê·¸ë¦¬ë“œ) </p>
    <p class="mb-2">- íŠ¹ì • ì§ì—…(í”¼íŠ¸ë‹ˆìŠ¤,ìš”ë¦¬ì‚¬ ë“±ë“±) ì˜ ê¸ì • íŠ¹ì„± ì˜ˆì™¸ ì²˜ë¦¬ ì ìš©</p>
    <p class="mb-2">- ì„ íƒí•œ íŠ¸ë ˆì‡ ì•„ì´ì½˜ì´ ê²°ê³¼ì°½ì— ëœ¨ë„ë¡ ìˆ˜ì •</p>
    <p class="mb-2">- í˜„ìì™€ ëŠë¦° í•™ìŠµ ì•„ì´ì½˜ì´ ê±°ê¾¸ë¡œ í‘œì‹œë˜ë˜ ë¬¸ì œ ìˆ˜ì •(pzWikiê°€ íŠ¸ë¡¤)</p>
    <p class="mb-2">- ê¸ì •/ë¶€ì •íŠ¹ì„±ì´ ì„œë¡œ ë°˜ëŒ€ ìƒ‰ìœ¼ë¡œ í‘œì‹œë˜ë˜ ë¬¸ì œ ìˆ˜ì •</p>
    <p>** ë³¸ í•­ëª©ì€ ì •í™•í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ** </p>
    <p>ìì„¸í•œ ë‚´ìš©ì€ ê³µì‹ ìœ„í‚¤ì™€ í”„ì¢€ê°¤ì„ ì°¸ê³ í•˜ì„¸ìš”</p>
    
    <div class="mt-4 text-right">
      <button id="closeModalBtn2" class="px-4 py-2 bg-gray-200 rounded-lg">ë‹«ê¸°</button>
    </div>
  </div>
</div>



<script>
  const version = "0.49"; // â† ë²„ì „ ìˆ«ì ë³€ìˆ˜
  document.getElementById("version-text").textContent = `ver ${version}`;
  document.getElementById("version-text2").textContent = `ver ${version}`;

  const modal = document.getElementById("modal");
  const openBtn = document.getElementById("openModalBtn");
  const closeBtn = document.getElementById("closeModalBtn");
  const closeBtn2 = document.getElementById("closeModalBtn2");

  openBtn.addEventListener("click", () => {
    modal.classList.remove("hidden");
  });

  closeBtn.addEventListener("click", () => {
    modal.classList.add("hidden");
  });

  closeBtn2.addEventListener("click", () => {
    modal.classList.add("hidden");
  });

  // ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.classList.add("hidden");
    }
  });
</script>

<script>
    const positiveDiv = document.getElementById('positive-items');
    const negativeDiv = document.getElementById('negative-items');
    const jobsDiv = document.getElementById('jobs');
    const resultDiv = document.getElementById('result');

    let allJobs = [];
    let allItems = [];
    let currentLang = "ko"; // "ko" ë˜ëŠ” "en"
    // ë²ˆì—­ í…Œì´ë¸”
    let translations = {
      ko: {
        sum: "í¬ì¸íŠ¸",
        strength: "ê·¼ë ¥",
        fitness: "ì²´ë ¥"
      },
      en: {
        sum: "Point",
        strength: "Strength",
        fitness: "Fitness"
      }
    };
    // 2. CSV ë¡œë”© í›„ ì—…ë°ì´íŠ¸
    Papa.parse("translations.csv", {
      download: true,
      header: true,
      complete: function(results) {
        results.data.forEach(row => {
          const key = row.key.trim();   // ì˜ˆ: "Agriculture"
          if(!translations.ko[key]) translations.ko[key] = row.ko.trim();
          if(!translations.en[key]) translations.en[key] = row.en.trim();
        });

       // console.log(translations);
        // ì´ì œ translations.ko["Agriculture"] -> "ë†ì—…"
        // translations.en["Agriculture"] -> "Agriculture"
      }
    });



  function loadCSV() {  
    Papa.parse("jobs.csv", {
      download: true,
      header: true,
      complete: function(results) {
        allJobs = results.data;
        Papa.parse("items.csv", {
          download: true,
          header: true,
          complete: function(results2) {
            allItems = results2.data;
            renderUI();
          }
        });
      }
    });
  }

  function renderUI() {
    jobsDiv.innerHTML = "";
    positiveDiv.innerHTML = "";
    negativeDiv.innerHTML = "";

    // ---- ì§ì—… ----
    allJobs.forEach(row => {
      if (!row["í•­ëª©"]) return;

      const names = row["í•­ëª©"].split(";");
      const langIndex = currentLang === "ko" ? 0 : 1;
      const displayName = names[langIndex] || names[0];

      const value = parseInt(row["ê°’"]) || 0;
      const statsStr = row.stats || "";
      const statPairs = statsStr.split(";"); // str:2;sta:1 ...
      const statObj = {};
      statPairs.forEach(pair => {
          const [key, val] = pair.split(":");
          if(key) statObj[key] = parseInt(val) || 0;
    });
      const displayValue = value >= 0 ? `+${value}` : `${value}`;

      const label = document.createElement("label");
      //label.className = "flex items-center p-2 border rounded-lg cursor-pointer";
      label.className = "flex items-center justify-between p-2 border rounded-lg cursor-pointer";

      const iconSrc = row.icon && row.icon.trim() !== "" ? row.icon : "default.png";

      //console.log(iconSrc);
      label.innerHTML = `
        <div class="flex items-center min-w-[150px]">
          <img src="${iconSrc}" class="w-16 h-16 mr-2" alt="ì•„ì´ì½˜">
          <span>${displayName} (${displayValue})</span>
        </div>
        <input type="radio" name="job" data-value="${value}" data-display-name="${displayName}" data-iconsrc="${iconSrc}"
          class="w-5 h-5 sm:w-4 sm:h-4">
      `;

      jobsDiv.appendChild(label);

      const input = label.querySelector("input");
      // statObjì˜ ëª¨ë“  key-valueë¥¼ datasetìœ¼ë¡œ ì €ì¥
      for (const statKey in statObj) {
      input.dataset[statKey] = statObj[statKey];  // ì˜ˆ: input.dataset.str = 2
      }
      input.dataset.value = value;
      input.addEventListener("change", updateSum);
    });

    // ---- íŠ¹ì„± ----
    allItems.forEach(row => {
      if (!row["í•­ëª©"]) return;

      const names = row["í•­ëª©"].split(";");
      const langIndex = currentLang === "ko" ? 0 : 1;
      const displayName = names[langIndex] || names[0];

      const value = parseInt(row["ê°’"]) || 0;
      const statsStr = row.stats || "";
      const statPairs = statsStr.split(";"); // str:2;fit:1 ...
      const statObj = {};
      statPairs.forEach(pair => {
          const [key, val] = pair.split(":");
          if(key) statObj[key] = parseInt(val) || 0;
    });

      const colorClass = value >= 0 ? "text-red-600" : "text-green-600";
      const displayValue = value >= 0 ? `+${value}` : `${value}`;

      const label = document.createElement("label");
      label.className = "flex items-center justify-between p-2 border rounded-lg cursor-pointer";

      const iconSrc = row.icon && row.icon.trim() !== "" ? row.icon : "default.png";

      label.innerHTML = `
        <div class="flex items-center min-w-[120px] sm:min-w-[120px]">
          <img src="${iconSrc}" class="w-8 h-8 sm:w-5 sm:h-5 mr-2" alt="ì•„ì´ì½˜">
          <span class="${colorClass} text-base sm:text-sm">${displayName} (${displayValue})</span>
        </div>
        <input type="checkbox"
          data-value="${value}" 
          data-display-name="${displayName}" 
          data-iconsrc="${iconSrc}"
          ${Object.entries(statObj).map(([k,v]) => `data-${k}="${v}"`).join(" ")}
          class="w-5 h-5 sm:w-4 sm:h-4"
        >
      `;
      if (value >= 0) positiveDiv.appendChild(label);
      else negativeDiv.appendChild(label);

      const input = label.querySelector("input");
      // statObjì˜ ëª¨ë“  key-valueë¥¼ datasetìœ¼ë¡œ ì €ì¥
      for (const statKey in statObj) {
      input.dataset[statKey] = statObj[statKey];  // ì˜ˆ: input.dataset.str = 2
      }
      input.dataset.value = value;
      input.addEventListener("change", updateSum);
    });

    updateSum(); // ì´ˆê¸° í•©ê³„ ê³„ì‚°
  }

  //íŠ¹ì„± ì´ˆê¸°í™”
  function resetExtraStats() {
    for (const key in extraStats) {
      extraStats[key].remove(); // ê¸°ì¡´ div ì‚­ì œ
    }
    Object.keys(extraStats).forEach(k => delete extraStats[k]);
  }

    const extraStats = {}; // key: div id, value: div element
    let selectedIcons = [];
    // í•©ê³„ ê³„ì‚°
    function updateSum() {
      resetExtraStats(); 
      selectedIcons = []; // ì•„ì´ì½˜ ë°°ì—´ ì´ˆê¸°í™”
    

      let sum = 0, strength = 5, fitness = 5;
      const statsTotal = {};
      const ignoreStats = []; // ë¬´ì‹œí•  í†µê³„ í•­ëª©
      document.querySelectorAll('input[type="radio"]').forEach(input => {
          //ì§ì—… ë¨¼ì € ignore í™•ì¸
          if (input.checked) {
            // stats ì²˜ë¦¬
            for (const key in input.dataset) {
              if (key != 'value' && key != 'str' && key != 'fit' && key != 'displayName'&& key != 'iconsrc' ) {
                const statName = key;
                //console.log(statName);
                let value = parseInt(input.dataset[key]) || 0;
                if(value == 0  ){
                  ignoreStats.push(statName); // ë¬´ì‹œí•  í†µê³„ í•­ëª© ì¶”ê°€
                } 
              }
              
            }
          }
      });
     

      
      document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
          if (input.checked) {


            if(ignoreStats.length>0){
              if(translations[currentLang][ignoreStats[0]] == input.dataset.displayName){
                //console.log(`ë¬´ì‹œ: ${input.dataset.displayName}`);
                return; // ë¬´ì‹œí•  í•­ëª©ì´ë©´ ê±´ë„ˆë›°ê¸°
              } 
            }
            const iconSrc = input.dataset.iconsrc;
            if (iconSrc != null && input.dataset.displayName != null) {
              // ë°°ì—´ì— ê°™ì€ src ê°€ì§„ ê²Œ ì´ë¯¸ ìˆëŠ”ì§€ ì²´í¬
              const exists = selectedIcons.some(icon => icon.src === iconSrc);
              if (!exists) {
                  selectedIcons.push({
                      src: iconSrc,
                      name: input.dataset.displayName // íˆ´íŒì— í‘œì‹œí•  ì´ë¦„
                  });
              }
          }
            


            sum += parseInt(input.dataset.value) || 0;
            strength += parseInt(input.dataset.str) || 0;
            fitness += parseInt(input.dataset.fit) || 0;

            const val = parseInt(input.dataset.value) || 0;
            // stats ì²˜ë¦¬
            for (const key in input.dataset) {
              if (key != 'value' && key != 'str' && key != 'fit' && key != 'displayName'&& key != 'iconsrc') {
                const statName = key;
                let value = parseInt(input.dataset[key]) || 0;
                //console.log( value);
                statsTotal[statName] = (statsTotal[statName] || 0) + parseInt(input.dataset[key] || 0);
               
              }
            }
          }
      });

      let resultSum = document.getElementById("result-sum");
      resultSum.classList.remove("text-red-600", "text-green-600");
      if (sum < 0) {
        resultSum.classList.add("text-red-600");
      } else {
        resultSum.classList.add("text-green-600");
      }
      resultSum.innerText =        `${translations[currentLang].sum} : ${sum}`;

      let resultStrength = document.getElementById("result-strength");
      resultStrength.classList.remove("text-red-600", "text-black-600");
      if (strength >10 || strength < 0) {
        resultStrength.classList.add("text-red-600");
      } else {
        resultStrength.classList.add("text-black-600");
      }
      resultStrength.innerText =  `${translations[currentLang].strength } : ${strength}/10`;
      let resultFitness = document.getElementById("result-fitness");
      resultFitness.classList.remove("text-red-600", "text-black-600"); 
      if ( fitness >10 || fitness< 0) {
        resultFitness.classList.add("text-red-600");
      } else {
        resultFitness.classList.add("text-black-600");
      }
      document.getElementById("result-fitness").innerText =    `${translations[currentLang].fitness} : ${fitness}/10`;

      // ë™ì  í•­ëª© í‘œì‹œ
      for (const statName in statsTotal) {
        const key = statName.trim();
        const label = translations[currentLang][key] || statName; 

        if (!extraStats[statName]) {
          const div = document.createElement('div');
         
          div.id = `result-${statName}`;
          const value = statsTotal[statName];
          div.innerText = value == 0 ? `${label}` : `${label} +${statsTotal[statName]}`;
          div.className = `py-1 px-2 border rounded-xl bg-white shadow text-lg font-semibold text-center
            ${value == 0 ? "text-gray-500" : "text-green-600"} `;

          // ì•„ì´ì½˜ ì˜ì—­ë³´ë‹¤ ìœ„ì—ë§Œ ì‚½ì…
          const resultPanel = document.getElementById('result-panel');
          const iconContainer = document.getElementById('result-icons');
          if (iconContainer) {
            resultPanel.insertBefore(div, iconContainer); // ì•„ì´ì½˜ ì˜ì—­ ìœ„ì— ë„£ê¸°
          } else {
            resultPanel.appendChild(div);
          }
          extraStats[statName] = div;
        } else {
          extraStats[statName].innerText = `${label} +${statsTotal[statName]}`;
        }
      }
      // ì•„ì´ì½˜ í‘œì‹œ
     renderSelectedIcons();
    }

    function renderSelectedIcons() {
      const resultPanel = document.getElementById("result-panel");

      // ì§ì—… ì•„ì´ì½˜ ì»¨í…Œì´ë„ˆ ìƒì„±/íšë“
// ì´ˆê¸°í™”
const jobIconsContainer = document.getElementById("job-icons");
const otherIconsContainer = document.getElementById("other-icons");

jobIconsContainer.innerHTML = "";
otherIconsContainer.innerHTML = "";

selectedIcons.forEach(icon => {
  const img = document.createElement("img");
  img.src = icon.src;
  img.title = icon.name;
  if (img.src.includes("Profession") ){
    img.className = "w-16 h-16 rounded shadow"; // Tailwind ê¸°ì¤€ í° ì•„ì´ì½˜
    jobIconsContainer.appendChild(img);
  } else {
    img.className = "w-6 h-6 rounded shadow";  // ì¼ë°˜ ì•„ì´ì½˜
    otherIconsContainer.appendChild(img);
  }
});


    }
  // CSV ë¶ˆëŸ¬ì˜¤ê¸°
  loadCSV('items.csv', positiveDiv); // ì–‘ìˆ˜/ìŒìˆ˜ëŠ” í•¨ìˆ˜ ë‚´ì—ì„œ ì²˜ë¦¬
  loadCSV('jobs.csv', jobsDiv, { colorPositive:'text-blue-500', colorNegative:'text-blue-700', type:'radio', name:'job' });
  updateSum();

    // ì–¸ì–´ ì „í™˜ ë²„íŠ¼
  document.getElementById("lang-ko").addEventListener("click", () => {
    currentLang = "ko";
    renderUI(); // UI ë‹¤ì‹œ ê·¸ë¦¼
  });

  document.getElementById("lang-en").addEventListener("click", () => {
    currentLang = "en";
    renderUI(); // UI ë‹¤ì‹œ ê·¸ë¦¼
  });
    </script>

</body>
</html>
